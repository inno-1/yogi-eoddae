<style>
    #map {
        width: 100%;
        height: 400px;
    }

    .iw-inner {
        padding: 10px;
    }
</style>

<script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId={{ result.MAP_CLIENT_ID }}"></script>

<script type="text/javascript">
    let map;
    let markers = [];
    let infowindows = [];

    $(document).ready(function () {

        // 초기 지도 위치 동작구 가운데 쯤인 상도역 좌표로 지정
        const y_cen = 37.503072;
        const x_cen = 126.947753;

        map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(y_cen, x_cen),
            zoom: 13,
            zoomControl: true,
            zoomControlOptions: {
                style: naver.maps.ZoomControlStyle.SMALL,
                position: naver.maps.Position.TOP_RIGHT
            }
        });

        let posts = {{ result.posts | tojson | safe }};

        for(let i = 0; i < posts.length; i++) {
            if(posts[i]['point']) {
                let marker = make_marker(posts[i]['point']);
                add_info(marker, posts[i]);
            }

        }
    })

    function make_marker(data) {
        let marker = new naver.maps.Marker({
            position: new naver.maps.LatLng(data["y"], data["x"]),
            map: map
        });
        markers.push(marker)
        return marker
    }

    function add_info(marker, data) {
        let html_temp = `<div class="iw-inner">
                        <h5>${data['title']}</h5>
                        <p>${data['location']}
                        </div>`;
        let infowindow = new naver.maps.InfoWindow({
            content: html_temp,
            maxWidth: 200,
            backgroundColor: "#fff",
            borderColor: "#e61950",
            borderWidth: 2,
            anchorSize: new naver.maps.Size(15, 15),
            anchorSkew: true,
            anchorColor: "#fff",
            pixelOffset: new naver.maps.Point(10, -10)
        });
        infowindows.push(infowindow)
        naver.maps.Event.addListener(marker, "click", function (e) {
            if (infowindow.getMap()) {
                infowindow.close();
            } else {
                infowindow.open(map, marker);
                map.setCenter(infowindow.position)
            }
        });
    }
</script>


<div id="map"></div>